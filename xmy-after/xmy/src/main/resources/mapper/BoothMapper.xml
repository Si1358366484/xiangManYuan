<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xmy.mapper.BoothMapper">

    <resultMap id="BoothResultMap" type="com.xmy.domain.entity.Booth">
        <id property="id" column="id"/>
        <result property="boothName" column="booth_name"/>
        <result property="boothCapacity" column="booth_capacity"/>
        <result property="boothStatus" column="booth_status"/>
        <result property="boothPrice" column="booth_price"/>
        <result property="boothTime" column="booth_time"/>
        <result property="boothType" column="booth_type"/>
        <result property="dbstatus" column="dbstatus"/>
    </resultMap>
    <!--    通用查询sql-->
    <sql id="baseSelect">
        SELECT * from booth as b where b.dbstatus != 2
    </sql>
    <!--    通用过滤sql-->
    <sql id="whereClause">
        <if test="boothName != null and boothName != ''">and b.booth_name like CONCAT('%',#{boothName},'%')</if>
        <if test="boothCapacity != null and boothCapacity != ''">and b.booth_capacity like CONCAT('%',#{boothCapacity},'%')</if>
        <if test="boothStatus != null and boothStatus != ''">and b.booth_status like CONCAT('%',#{boothStatus},'%')</if>
        <if test="boothPrice != null">and CAST(b.booth_price AS CHAR) like CONCAT('%',#{boothPrice},'%')</if>
        <if test="boothTime != null and boothTime != ''">and b.booth_time like CONCAT('%',#{boothTime},'%')</if>
        <if test="boothType != null and boothType != ''">and b.booth_type like CONCAT('%',#{boothType},'%')</if>
        <if test="dbstatus != null">and b.dbstatus = #{dbstatus}</if>
    </sql>
    <select id="selectBoothList" resultMap="BoothResultMap">
        <include refid="baseSelect"/>
        <include refid="whereClause"/>
    </select>

    <select id="selectBoothStatusCount" resultType="com.xmy.domain.dto.BoothStatusCount">
        SELECT
            COUNT(*) as total,
            SUM(CASE WHEN booth_status = '空闲' THEN 1 ELSE 0 END) as freeCount,
            SUM(CASE WHEN booth_status = '占用' THEN 1 ELSE 0 END) as occupyCount,
            SUM(CASE WHEN booth_status = '已预约' THEN 1 ELSE 0 END) as reserveCount
        FROM booth
        WHERE dbstatus != 2
    </select>
</mapper>